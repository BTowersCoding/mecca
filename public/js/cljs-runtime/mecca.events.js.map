{"version":3,"sources":["mecca/events.cljs"],"mappings":"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","names":["re_frame.core.reg_event_db.cljs$core$IFn$_invoke$arity$2","_","js/AudioContext","re_frame.core.reg_event_db.cljs$core$IFn$_invoke$arity$3","day8.re_frame.undo.undoable.cljs$core$IFn$_invoke$arity$1","p__45825","vec__45826","cljs.core.nth.cljs$core$IFn$_invoke$arity$3","db","time","pitch","cljs.core.update.cljs$core$IFn$_invoke$arity$3","note","p1__45824#","cljs.core.remove.cljs$core$IFn$_invoke$arity$2","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","p__45829","vec__45830","file","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","p__45833","vec__45834","samples","p__45837","vec__45838","beats-per-measure","p__45841","vec__45842","notes","p__45845","vec__45846","new-time","p__45849","vec__45850","mecca.music/play-song!","cljs.core/deref","G__45853","re-frame.core/subscribe","p__45854","vec__45855","p__45858","vec__45862","cljs.core/not","p__45866","vec__45867","p__45870","vec__45871","p__45874","vec__45875","p__45878","vec__45879","G__45882","re-frame.core/dispatch","p__45883","vec__45884","pos","p__45889","vec__45890","instrument","cljs.core.assoc.cljs$core$IFn$_invoke$arity$variadic","p__45894","vec__45895","p__45901","vec__45902","G__45905","beat","G__45906","to-play","p1__45899#","cljs.core.filter.cljs$core$IFn$_invoke$arity$2","G__45908","p1__45900#","p__45910","vec__45911","beats","p1__45909#","p__45916","vec__45917","p1__45915#","p__45920","vec__45921","p__45926","vec__45929","p1__45925#","p__45932","vec__45933","p__45936","vec__45937","tempo","p__45941","vec__45942","p1__45940#","p__45948","vec__45949","p1__45947#","p__45953","vec__45954","key","p__45959","vec__45960","p__45963","vec__45964","x","p__45968","vec__45969","G__45972","seconds-per-beat","p1__45967#","cljs.core/inc","p__45973","vec__45974","mecca.music/play-note","p__45980","vec__45981","G__45984","G__45985","p1__45977#","cljs.core.update.cljs$core$IFn$_invoke$arity$4","cljs.core/into","p__45986","vec__45987","G__45990","G__45991","mecca.music/play-sample","G__45992","cljs.core/conj","G__45993","p__45997","vec__45998","cljs.core.not_EQ_.cljs$core$IFn$_invoke$arity$2","G__46005","G__46006","p1__45995#","p1__45994#","cljs.core.get.cljs$core$IFn$_invoke$arity$2","G__46008","p1__45996#","p__46009","vec__46010","p__46013","vec__46014","xml","p__46017","vec__46018","p__46021","vec__46022","G__46025","mecca.songs.megaman/megaman","p__46026","vec__46027","G__46030","mecca.songs.city/city","p__46031","vec__46032","G__46035","mecca.songs.zelda/zelda"],"sourcesContent":["(ns mecca.events\n  (:require\n   [re-frame.core :refer [reg-event-db reg-event-fx dispatch subscribe]]\n   [re-pressed.core :as rp]\n   [day8.re-frame.undo :as undo :refer [undoable]]\n   [mecca.mario :as mario :refer [mario]]\n   [mecca.songs.megaman :as megaman]\n   [mecca.songs.zelda :as zelda]\n   [mecca.songs.city :as city]\n   [mecca.music :as music]\n   [goog.events :refer [listen unlisten]])\n  (:import [goog.events EventType]))\n\n(reg-event-db\n :initialize-db\n (fn [_ _]\n   {:audio-context (js/AudioContext.)\n    :samples nil\n    :focused-note-pos [nil nil]\n    :eraser? false\n    :playing? false\n    :play-start 0\n    :jumping? false\n    :sharp? false\n    :repeat? false\n    :loop-end nil\n    :current-position 0\n    :current-note 0\n    :next-note-time 0.0\n    :notes-in-queue []\n    :editor-beat-start 1\n    :instrument 1\n    :array-buffer nil\n    :time 0\n    :time-signature 4\n    :tempo 120\n    :notes []\n    :mario-x 16\n    :mario-y 61\n    :mario-jump 0\n    :mario-run 1\n    :xml \"\"\n    :file-upload \"\"}))\n\n(reg-event-db\n :remove-note\n (undoable \"remove note\")\n (fn [db [_ time pitch]]\n   (update db :notes\n           (fn [note]\n             (remove #(and (= time (:time %))\n                           (= pitch (:pitch %)))\n                     note)))))\n\n(reg-event-db\n :file-upload\n (fn [db [_ file]]\n      (assoc db :file-upload file)))\n\n(reg-event-db\n :load-samples\n (fn [db [_ samples]]\n   (assoc db :samples samples)))\n\n(reg-event-db\n :set-time-signature\n (fn [db [_ beats-per-measure]]\n   (update db :time-signature beats-per-measure)))\n\n(reg-event-db\n :set-notes\n (fn [db [_ notes]]\n   (assoc db :notes notes)))\n\n(reg-event-db                 ;; usage:  (dispatch [:timer a-js-Date])\n :timer                         ;; every second an event of this kind will be dispatched\n (fn [db [_ new-time]]          ;; note how the 2nd parameter is destructured to obtain the data value\n   (assoc db :time new-time)))\n\n(reg-event-db\n :play-on\n (fn [db [_ _]]\n   (music/play-song!)\n   (assoc\n    (assoc db :play-start (.-currentTime @(subscribe [:audio-context])))\n    :playing? true)\n    ))\n\n(reg-event-db\n :sharp-on\n (fn [db [_ _]]\n   (assoc db :sharp? true)))\n\n(reg-event-db\n :sharp-toggle\n (fn [db [_ _]]\n   (update db :sharp? not)))\n\n(reg-event-db\n :eraser-toggle\n (fn [db [_ _]]\n   (update db :eraser? not)))\n\n(reg-event-db\n :sharp-off\n (fn [db [_ _]]\n   (assoc db :sharp? false)))\n\n(reg-event-db\n :pause\n (fn [db [_ _]]\n   (assoc db :playing? false)))\n\n(reg-event-db\n :stop\n (fn [db [_ _]]\n   (dispatch [:reset-editor])\n   (assoc\n    (assoc db :playing? false)\n    :current-position 0)))\n\n(reg-event-db\n :update-focus-note\n (fn [db [_ pos]]\n   (assoc db :focused-note-pos pos)))\n\n(reg-event-db\n :select-instrument\n (fn [db [_ instrument]]\n   (assoc db \n          :instrument instrument\n          :eraser? false)))\n\n(reg-event-db\n :play-off\n (fn [db [_ _]]\n   (assoc db :playing? false)))\n\n(reg-event-db\n :advance-position\n (fn [db [_ _]]\n   (let [notes (subscribe [:notes])\n         beat (subscribe [:current-position])\n         to-play (filter #(= (+ 1 @beat) (:time %)) @notes)]\n     (if (< 4 @beat)\n       (dispatch [:advance-editor 0.5]))\n     #_(doall (for [{:keys [instrument pitch]} to-play]\n                (music/play-sample instrument (if @(subscribe [:sharp?]) (+ 0.5 pitch) pitch))))\n     (update db :current-position #(+ 0.5 %)))))\n\n(reg-event-db\n :advance-editor\n (fn [db [_ beats]]\n   (update db :editor-beat-start #(+ beats %))))\n\n(reg-event-db\n :move-mario\n (fn [db [_ _]]\n   (update db :mario-x #(+ 10 %))))\n\n(reg-event-db\n :reset-editor\n (fn [db [_ _]]\n   (assoc (assoc db :editor-beat-start 1)\n          :mario-x 16)))\n\n(reg-event-db\n :retract-editor\n (fn [db [_ _]]\n   (update db :editor-beat-start #(- % 0.5))))\n\n(reg-event-db\n :reset-position\n (fn [db [_ _]]\n   (assoc db :current-position 0)))\n\n(reg-event-db\n :set-tempo\n (fn [db [_ tempo]]\n   (assoc db :tempo tempo)))\n\n(reg-event-db\n :inc-tempo\n (fn [db [_ tempo]]\n   (update db :tempo #(+ 8 %))))\n\n(reg-event-db\n :dec-tempo\n (fn [db [_ tempo]]\n   (update db :tempo #(- % 8))))\n\n(reg-event-db\n :set-key\n (fn [db [_ key]]\n   (assoc db :key key)))\n\n(reg-event-db\n :repeat-toggle\n (fn [db [_ _]]\n   (update db :repeat? not)))\n\n(reg-event-db\n :set-loop-end\n (fn [db [_ x]]\n   (assoc db :loop-end x)))\n\n(reg-event-db\n :next-note\n (fn [db [_ _]]\n   (let [tempo (subscribe [:tempo])\n         seconds-per-beat (/ 60.0 @tempo)]\n     (update \n      (update db :current-note inc)\n      :next-note-time #(+ % seconds-per-beat)))))\n\n(reg-event-db\n :play-note\n (fn [db [_ pitch]]\n   (music/play-note pitch)\n   (assoc db :notes-in-queue [{:pitch pitch\n                               :time  0}])))\n\n(reg-event-db\n :schedule-note\n (fn [db [_ _]]\n   (let [notes (subscribe [:notes])\n         beat (subscribe [:current-note])\n         to-play (filter #(= (+ 1 @beat) (:time %)) @notes)]\n     (update db :notes-in-queue\n             into to-play))))\n\n(reg-event-db\n :add-note\n (undoable \"add note\")\n (fn [db [_ instrument time pitch]]\n   (if (= (.-state @(subscribe [:audio-context])) \"suspended\")\n     (.resume @(subscribe [:audio-context])))\n   (music/play-sample instrument (if @(subscribe [:sharp?]) (inc pitch) pitch))\n   (update db :notes\n           conj \n           {:time time\n            :instrument instrument\n            :pitch (if @(subscribe [:sharp?])\n                    (inc pitch) pitch)})))\n\n\n;; TODO This is gross.\n;; Make it so the run counter only runs when needed.\n;; But this tick function needs to be refactored.\n;; Seriously it's like 50 shades of awful.\n;; Read about effectful handlers some more,\n;; and learn to use reg-event-fx.\n\n(reg-event-db\n :tick!\n (fn [db [_ _]]\n   (if (and (not= 0 @(subscribe [:mario-jump]))\n            @(subscribe [:playing?]))\n     (assoc\n      (update\n       (update db :mario-run #(if (= % 12) 0 (inc %)))\n       :mario-jump #(if (= 8 %) 0 (inc %)))\n      :mario-y (- 61\n                  (get [5 10 15 25 30 25 15 5]\n                       @(subscribe [:mario-jump]))))\n     (update db :mario-run #(if (= % 12) 0 (inc %))))))\n\n(reg-event-db\n :jump!\n (fn [db [_ _]]\n   (assoc db :mario-jump 1)))\n\n(reg-event-db\n :submit-xml\n (fn [db [_ xml]]\n   (assoc db :xml xml)))\n\n(reg-event-db\n :load-song\n (fn [db [_ notes]]\n   (assoc db :notes notes)))\n\n(reg-event-db\n :load-megaman\n (fn [db [_ notes]]\n   (dispatch [:set-tempo 260])\n   (assoc db :notes\n          megaman/megaman)))\n\n(reg-event-db\n :load-castle\n (fn [db [_ notes]]\n   (dispatch [:set-tempo 150])\n   (assoc db :notes city/city)))\n\n(reg-event-db\n :load-zelda\n (fn [db [_ notes]]\n   (dispatch [:set-tempo 390])\n   (assoc db :notes zelda/zelda)))\n\n"]}
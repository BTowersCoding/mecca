{"version":3,"sources":["mecca/events.cljs"],"mappings":"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","names":["re_frame.core.reg_event_db","_","js/AudioContext","day8.re_frame.undo.undoable","p__60472","vec__60473","cljs.core.nth","db","time","pitch","cljs.core.update","note","p1__60471#","cljs.core.remove","cljs.core._EQ_","p__60480","vec__60481","file","cljs.core.assoc","p__60484","vec__60485","samples","p__60488","vec__60489","beats-per-measure","p__60492","vec__60493","notes","p__60496","vec__60497","new-time","p__60500","vec__60501","mecca.music/play-song!","cljs.core/deref","re_frame.core.subscribe","p__60504","vec__60505","p__60514","vec__60515","cljs.core/not","p__60518","vec__60519","p__60523","vec__60524","p__60527","vec__60528","p__60531","vec__60532","re-frame.core/dispatch","p__60535","vec__60536","pos","p__60539","vec__60540","instrument","p__60543","vec__60544","p__60549","vec__60550","beat","to-play","p1__60547#","cljs.core.filter","p1__60548#","p__60554","vec__60555","beats","p1__60553#","p__60559","vec__60560","p1__60558#","p__60563","vec__60564","p__60568","vec__60569","p1__60567#","p__60572","vec__60573","p__60577","vec__60578","tempo","p__60582","vec__60583","p1__60581#","p__60587","vec__60588","p1__60586#","p__60591","vec__60592","key","p__60595","vec__60596","p__60599","vec__60604","x","p__60608","vec__60609","seconds-per-beat","p1__60607#","cljs.core/inc","p__60613","vec__60614","mecca.music/play-note","p__60618","vec__60619","p1__60617#","cljs.core/into","p__60623","vec__60624","mecca.music/play-sample","cljs.core/conj","p__60630","vec__60631","and__4221__auto__","cljs.core.not_EQ_","p1__60628#","p1__60627#","cljs.core.get","p1__60629#","p__60634","vec__60635","p__60638","vec__60639","xml","p__60642","vec__60643","p__60646","vec__60647","mecca.songs.megaman/megaman","p__60651","vec__60652","mecca.songs.city/city","p__60655","vec__60656","mecca.songs.zelda/zelda"],"sourcesContent":["(ns mecca.events\r\n  (:require\r\n   [re-frame.core :refer [reg-event-db reg-event-fx dispatch subscribe]]\r\n   [re-pressed.core :as rp]\r\n   [mecca.sci-editor :as sci-editor :refer [!points points]]\r\n   [day8.re-frame.undo :as undo :refer [undoable]]\r\n   [mecca.mario :as mario :refer [mario]]\r\n   [mecca.songs.megaman :as megaman]\r\n   [mecca.songs.zelda :as zelda]\r\n   [mecca.songs.city :as city]\r\n   [mecca.music :as music]\r\n   [goog.events :refer [listen unlisten]])\r\n  (:import [goog.events EventType]))\r\n\r\n(reg-event-db\r\n :initialize-db\r\n (fn [_ _]\r\n   {:audio-context (js/AudioContext.)\r\n    :samples nil\r\n    :focused-note-pos [nil nil]\r\n    :eraser? false\r\n    :playing? false\r\n    :play-start 0\r\n    :jumping? false\r\n    :sharp? false\r\n    :repeat? false\r\n    :loop-end nil\r\n    :current-position 0\r\n    :current-note 0\r\n    :next-note-time 0.0\r\n    :notes-in-queue []\r\n    :editor-beat-start 1\r\n    :instrument 1\r\n    :array-buffer nil\r\n    :time 0\r\n    :time-signature 4\r\n    :tempo 120\r\n    :notes []\r\n    :mario-x 16\r\n    :mario-y 61\r\n    :mario-jump 0\r\n    :mario-run 1\r\n    :xml \"\"\r\n    :file-upload \"\"}))\r\n\r\n(reg-event-db\r\n :remove-note\r\n (undoable \"remove note\")\r\n (fn [db [_ time pitch]]\r\n   (update db :notes\r\n           (fn [note]\r\n             (remove #(and (= time (:time %))\r\n                           (= pitch (:pitch %)))\r\n                     note)))))\r\n\r\n(reg-event-db\r\n :file-upload\r\n (fn [db [_ file]]\r\n      (assoc db :file-upload file)))\r\n\r\n(reg-event-db\r\n :load-samples\r\n (fn [db [_ samples]]\r\n   (assoc db :samples samples)))\r\n\r\n(reg-event-db\r\n :set-time-signature\r\n (fn [db [_ beats-per-measure]]\r\n   (update db :time-signature beats-per-measure)))\r\n\r\n(reg-event-db\r\n :set-notes\r\n (fn [db [_ notes]]\r\n   (assoc db :notes notes)))\r\n\r\n(reg-event-db                 ;; usage:  (dispatch [:timer a-js-Date])\r\n :timer                         ;; every second an event of this kind will be dispatched\r\n (fn [db [_ new-time]]          ;; note how the 2nd parameter is destructured to obtain the data value\r\n   (assoc db :time new-time)))\r\n\r\n(reg-event-db\r\n :play-on\r\n (fn [db [_ _]]\r\n   (music/play-song!)\r\n   (assoc\r\n    (assoc db :play-start (.-currentTime @(subscribe [:audio-context])))\r\n    :playing? true)\r\n    ))\r\n\r\n(reg-event-db\r\n :sharp-on\r\n (fn [db [_ _]]\r\n   (assoc db :sharp? true)))\r\n\r\n(reg-event-db\r\n :sharp-toggle\r\n (fn [db [_ _]]\r\n   (update db :sharp? not)))\r\n\r\n(reg-event-db\r\n :eraser-toggle\r\n (fn [db [_ _]]\r\n   (update db :eraser? not)))\r\n\r\n(reg-event-db\r\n :sharp-off\r\n (fn [db [_ _]]\r\n   (assoc db :sharp? false)))\r\n\r\n(reg-event-db\r\n :pause\r\n (fn [db [_ _]]\r\n   (assoc db :playing? false)))\r\n\r\n(reg-event-db\r\n :stop\r\n (fn [db [_ _]]\r\n   (dispatch [:reset-editor])\r\n   (assoc\r\n    (assoc db :playing? false)\r\n    :current-position 0)))\r\n\r\n(reg-event-db\r\n :update-focus-note\r\n (fn [db [_ pos]]\r\n   (assoc db :focused-note-pos pos)))\r\n\r\n(reg-event-db\r\n :select-instrument\r\n (fn [db [_ instrument]]\r\n   (assoc db \r\n          :instrument instrument\r\n          :eraser? false)))\r\n\r\n(reg-event-db\r\n :play-off\r\n (fn [db [_ _]]\r\n   (assoc db :playing? false)))\r\n\r\n(reg-event-db\r\n :advance-position\r\n (fn [db [_ _]]\r\n   (let [notes (subscribe [:notes])\r\n         beat (subscribe [:current-position])\r\n         to-play (filter #(= (+ 1 @beat) (:time %)) @notes)]\r\n     (if (< 4 @beat)\r\n       (dispatch [:advance-editor 0.5]))\r\n     #_(doall (for [{:keys [instrument pitch]} to-play]\r\n                (music/play-sample instrument (if @(subscribe [:sharp?]) (+ 0.5 pitch) pitch))))\r\n     (update db :current-position #(+ 0.5 %)))))\r\n\r\n(reg-event-db\r\n :advance-editor\r\n (fn [db [_ beats]]\r\n   (update db :editor-beat-start #(+ beats %))))\r\n\r\n(reg-event-db\r\n :move-mario\r\n (fn [db [_ _]]\r\n   (update db :mario-x #(+ 10 %))))\r\n\r\n(reg-event-db\r\n :reset-editor\r\n (fn [db [_ _]]\r\n   (assoc (assoc db :editor-beat-start 1)\r\n          :mario-x 16)))\r\n\r\n(reg-event-db\r\n :retract-editor\r\n (fn [db [_ _]]\r\n   (update db :editor-beat-start #(- % 0.5))))\r\n\r\n(reg-event-db\r\n :reset-position\r\n (fn [db [_ _]]\r\n   (assoc db :current-position 0)))\r\n\r\n(reg-event-db\r\n :set-tempo\r\n (fn [db [_ tempo]]\r\n   (assoc db :tempo tempo)))\r\n\r\n(reg-event-db\r\n :inc-tempo\r\n (fn [db [_ tempo]]\r\n   (update db :tempo #(+ 8 %))))\r\n\r\n(reg-event-db\r\n :dec-tempo\r\n (fn [db [_ tempo]]\r\n   (update db :tempo #(- % 8))))\r\n\r\n(reg-event-db\r\n :set-key\r\n (fn [db [_ key]]\r\n   (assoc db :key key)))\r\n\r\n(reg-event-db\r\n :repeat-toggle\r\n (fn [db [_ _]]\r\n   (update db :repeat? not)))\r\n\r\n(reg-event-db\r\n :set-loop-end\r\n (fn [db [_ x]]\r\n   (assoc db :loop-end x)))\r\n\r\n(reg-event-db\r\n :next-note\r\n (fn [db [_ _]]\r\n   (let [tempo (subscribe [:tempo])\r\n         seconds-per-beat (/ 60.0 @tempo)]\r\n     (update \r\n      (update db :current-note inc)\r\n      :next-note-time #(+ % seconds-per-beat)))))\r\n\r\n(reg-event-db\r\n :play-note\r\n (fn [db [_ pitch]]\r\n   (music/play-note pitch)\r\n   (assoc db :notes-in-queue [{:pitch pitch\r\n                               :time  0}])))\r\n\r\n(reg-event-db\r\n :schedule-note\r\n (fn [db [_ _]]\r\n   (let [notes (subscribe [:notes])\r\n         beat (subscribe [:current-note])\r\n         to-play (filter #(= (+ 1 @beat) (:time %)) @notes)]\r\n     (update db :notes-in-queue\r\n             into to-play))))\r\n\r\n(reg-event-db\r\n :add-note\r\n (undoable \"add note\")\r\n (fn [db [_ instrument time pitch]]\r\n   (if (= (.-state @(subscribe [:audio-context])) \"suspended\")\r\n     (.resume @(subscribe [:audio-context])))\r\n   ;(sci-editor/update-editor! (str @(subscribe [:notes])))\r\n   (music/play-sample instrument (if @(subscribe [:sharp?]) (inc pitch) pitch))\r\n   (update db :notes\r\n           conj \r\n           {:time time\r\n            :instrument instrument\r\n            :pitch (if @(subscribe [:sharp?])\r\n                    (inc pitch) pitch)})\r\n   ))\r\n\r\n\r\n;; TODO This is gross.\r\n;; Make it so the run counter only runs when needed.\r\n;; But this tick function needs to be refactored.\r\n;; Seriously it's like 50 shades of awful.\r\n;; Read about effectful handlers some more,\r\n;; and learn to use reg-event-fx.\r\n\r\n(reg-event-db\r\n :tick!\r\n (fn [db [_ _]]\r\n   (if (and (not= 0 @(subscribe [:mario-jump]))\r\n            @(subscribe [:playing?]))\r\n     (assoc\r\n      (update\r\n       (update db :mario-run #(if (= % 12) 0 (inc %)))\r\n       :mario-jump #(if (= 8 %) 0 (inc %)))\r\n      :mario-y (- 61\r\n                  (get [5 10 15 25 30 25 15 5]\r\n                       @(subscribe [:mario-jump]))))\r\n     (update db :mario-run #(if (= % 12) 0 (inc %))))))\r\n\r\n(reg-event-db\r\n :jump!\r\n (fn [db [_ _]]\r\n   (assoc db :mario-jump 1)))\r\n\r\n(reg-event-db\r\n :submit-xml\r\n (fn [db [_ xml]]\r\n   (assoc db :xml xml)))\r\n\r\n(reg-event-db\r\n :load-song\r\n (fn [db [_ notes]]\r\n   (assoc db :notes notes)))\r\n\r\n(reg-event-db\r\n :load-megaman\r\n (fn [db [_ notes]]\r\n   (dispatch [:set-tempo 260])\r\n   (assoc db :notes\r\n          megaman/megaman)))\r\n\r\n(reg-event-db\r\n :load-castle\r\n (fn [db [_ notes]]\r\n   (dispatch [:set-tempo 150])\r\n   (assoc db :notes city/city)))\r\n\r\n(reg-event-db\r\n :load-zelda\r\n (fn [db [_ notes]]\r\n   (dispatch [:set-tempo 390])\r\n   (assoc db :notes zelda/zelda)))\r\n\r\n"]}